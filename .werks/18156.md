[//]: # (werk v2)
# Prevent site Apache stopped with syntax error due to undefined symbol

key        | value
---------- | ---
date       | 2025-09-12T09:36:40+00:00
version    | 2.4.0p13
class      | fix
edition    | cre
component  | packages
level      | 2
compatible | yes

In previous versions of Checkmk, an update of the packages `apache2` or `apache2-bin` would cause the site Apache to crash on the next reload.
This crash commonly occured at midnight, when a site rotates the Apache logs.
In such an instance, `omd status` would show that the site is partially running.
Moreover, the following error could be found in `/omd/sites/cmk/var/log/apache/error_log`:
```
[mpm_prefork:notice] [pid 2364] AH00171: Graceful restart requested, doing restart apache2: Syntax error on line 126 of /omd/sites/cmk/etc/apache/apache.conf: Cannot load /omd/sites/cmk/lib/apache/modules/mod_headers.so into server: /omd/sites/cmk/lib/apache/modules/mod_headers.so: undefined symbol: ap_set_content_type_ex
```

With this change, all OMD sites will be restarted after an update of the `apache2` or `apache2-bin` packages.
This prevents the crash.

## Background

The active Apache process is not able to gracefully reload after the `apache` or `apache2-bin` packages have been updated.
For this reason, distributions include post update triggers, e.g., `/var/lib/dpkg/info/apache2.postinst`.
These ensure that the system Apache is restarted after the update.
Checkmk now also includes these triggers to restart the site Apache.
