[//]: # (werk v2)
# messaging: correctly start RabbitMQ in case of ipv6 disabled

key        | value
---------- | ---
date       | 2025-07-30T13:38:54+00:00
version    | 2.4.0p10
class      | fix
edition    | cre
component  | packages
level      | 1
compatible | no

On systems with IPv6 disabled, RabbitMQ was not starting, with an error in the logs similar to this one:

    Failed to start Ranch listener {acceptor,{0,0,0,0,0,0,0,1},15672} in
    ranch_tcp:listen(#{socket_opts => [{cacerts,'...'},{key,'...'},{cert,'...'},
    {ip,{0,0,0,0,0,0,0,1}},{port,15672}]}) for reason eaddrnotavail (can't assign requested address)

From this werk, the management listener IP (localhost) is computed during RabbitMQ restart:
'::1' if IPv6 is enabled, '127.0.0.1' if IPv6 is disabled.
The default IP list from which RabbitMQ accepts connections (via the AMQP protocol) is also expanded:
it was only '::' and now includes '0.0.0.0', ensuring the listeners are running even when IPv6 is disabled.

Manual Intervention Required:
- Service Restart: If IPv6 is disabled while Checkmk is active, restart RabbitMQ to re-initialize the listeners: `omd restart rabbitmq`.
- Configuration Update: Following an upgrade of Checkmk, ensure the `RABBITMQ_ONLY_FROM` setting includes both address families. Set this to `:: 0.0.0.0` under `omd config > Basics`.
