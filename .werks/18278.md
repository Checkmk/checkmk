[//]: # (werk v2)
# Agent updater/non-root agent: Lockfile race condition

key        | value
---------- | ---
date       | 2025-09-02T06:38:21+00:00
version    | 2.5.0b1
class      | fix
edition    | cee
component  | agents
level      | 1
compatible | yes

As also mentioned in Werk #18271, the agent updater deployed with the non-root agent runs in two different modes:
The update mode, that runs under the agent user as a plugin, and the install mode, that runs under root.

Since the agent updater is not allowed to perform sytem or network I/O from multiple processes at the same time,
this is prevented by holding a lock on a PID file.<br>
When blocked by another process, the agent updater will wait up to 10 seconds on the locked PID file before giving up.<br>
In case of an agent updater already running under root, an agent updater running under the agent user failed to wait,
but crashed immediately, because it couldn't open the root-owned lockfile.

This lead to delayed agent updates because the agent updater would only retry on the next update cycle.

The agent updater will now instead wait on an existing PID file even if it can't be opened.
