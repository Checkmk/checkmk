[//]: # (werk v2)
# Restore async/cached agent plugins

key        | value
---------- | ---
date       | 2025-07-29T14:00:33+00:00
version    | 2.4.0p9
class      | fix
edition    | cre
component  | checks
level      | 1
compatible | yes

This reverts [Werk #16813](https://checkmk.com/werk/16813) and [Werk #18216](https://checkmk.com/werk/18216)

[Werk #16813](https://checkmk.com/werk/16813) changed the way async agent
plugins were executed and killed if they took longer than the creation timeout
(twice the interval of the async execution). It utilized `setsid` which is
not available on all platforms.

On platforms without `setsid` the new implementation caused flapping agent
timeout warnings in the Checkmk Service.

We decided to revert the new implementation and go back to the implementation of
Checkmk 2.3

Please note that this means that async agent plugins that take longer than the
creation timeout are not killed and will take up resources until they finished.
You can notice that by the warnings generated by the agent plugin timeouts in
the Checkmk Service. You should then decide to either remove the plugin, or set
higher values for the interval of said plugin (using the agent bakery rule "Set
cache age for plug-ins (Linux, UNIX)"), as this also prolongs the creation
timeout.
