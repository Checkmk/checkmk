[//]: # (werk v2)
# omd update: Add --skeleton and --pre-flight

key        | value
---------- | ---
date       | 2025-11-11T07:02:08+00:00
version    | 2.5.0b1
class      | feature
edition    | cre
component  | omd
level      | 2
compatible | no

The `--conflict` flag previously controlled two distinct parts of the update process, but its behavior was never clearly specified.
When updating a site, the first step is a file-based update procedure similar to those used in Linux distributions.
The second step calls cmk-update-config with the `--conflict` option, which manages conflicts during configuration verification.
However, `cmk-update-config` cannot retain old configuration versions because the new Checkmk version requires configuration files to match the current schema.

To address this, `omd` now provides two separate options to replace `--conflict`.
The `--skeleton` option controls the file-based update procedure. Specifically, it supports the following values:

* `skeleton=ask`: the default, interactively query the action from the user.
* `skeleton=abort`: abort the update upon detection of a conflict.
* `skeleton=install`: discard changes made by the user and install the file from the new version.
* `skeleton=keepold`: keep the old file and ignore the file from the new version.

The `--pre-flight` option controls the behavior of `cmk-update-config`. Similarly, it supports these values:

* `pre-flight=ask`: the default, interactively query the action from the user.
* `pre-flight=ignore`: if a conflict is detected, take the appropriate action and continue the update.
* `pre-flight=abort`: if a conflict is detected, abort the update.

Many of these options correspond to those previously available with `--conflict`.

By explicitly setting `--skeleton` and `--pre-flight`, you can control how conflicts are handled at each stage, ensuring smoother, non-interactive updates or enforcing stricter checks as needed.
The default settings remain safe for typical use but can be customized to fit your update workflow.

If you use the `--conflict` flag during site updates, you must now replace it with the new `--skeleton` and `--pre-flight` options to control conflict resolution behavior.
The flag `--conflict` is deprecated and will be removed with Checkmk 2.6.
This Werk removes the semantically ambiguous options `cmk-update-config --conflict=install` and `cmk-update-config --conflict=keepold`.
