[//]: # (werk v2)
# Agent updater/non-root agent: Stops working after logfile rotation

key        | value
---------- | ---
date       | 2025-10-21T06:27:25+00:00
version    | 2.5.0b1
class      | fix
edition    | cee
component  | agents
level      | 1
compatible | no

This is a follow-up to Werk #18278.

When using the agent updater together with the non-root agent deployment, agent updates stopped working on `cmk-update-agent.log` logfile rotation.

Technical background:<br>
Additional to the PID-file - see Werk mentioned above - the two instances of `cmk-update-agent` also share the same logfile.<br>
The logfile normally gets created by the agent updater running under the non-root user.<br>
After a while the logfile gets rotated, i.e., `cmk-update-agent.log` is moved to `cmk-update-agent.log.1` and a new `cmk-update-agent.log` is created.<br>
This is normally done by the agent updater running under root, since it's invoked every minute.<br>
However, the new logfile gets created with root ownership, and the non-root agent updater instance can't initialize logging, resulting in a crash.

To unblock agent installations to perform updates again, you can change the ownership of the logfile manually:

`chown cmk-agent:cmk-agent /opt/checkmk/agent/default/runtime/cmk-update-agent.log`

Please make sure to update the agent soon, since the error would come back after next logfile rotation.
