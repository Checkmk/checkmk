#!/bin/bash
# Copyright (C) 2019 tribe29 GmbH - License: GNU General Public License v2
# This file is part of Checkmk (https://checkmk.com). It is subject to the terms and
# conditions defined in the file COPYING, which is part of this source code package.

# this check will only run if we have a working nfs environment or SHOULD have one.
# not tested for nfs3

# verify if there are exports defined in your local /etc/exports
if [ -r /etc/exports ]; then
    EXPORTS=$(grep -v -e ^# -e ^$ /etc/exports)
fi

if [ "$EXPORTS" ] && pgrep '(portmap|rpcbind)' >/dev/null && pgrep rpc.mountd >/dev/null
then
    echo "<<<nfsexports>>>"
    waitmax 3 showmount --no-headers -e
fi
