#!/usr/bin/env python3
# Copyright (C) 2022 Checkmk GmbH - License: GNU General Public License v2
# This file is part of Checkmk (https://checkmk.com). It is subject to the terms and
# conditions defined in the file COPYING, which is part of this source code package.
import sys

from cmk.otel_collector.backends.files import (
    get_data_backend,
)


def main() -> int:
    sys.stdout.write("<<<otel_metrics:sep(0)>>>\n")
    for timestamp, content in get_data_backend().get_self_monitoring_data():
        for line in content.split("\n"):
            if not line.strip() == "":
                sys.stdout.write(f"{timestamp} {content}" + "\n")

    return 0


if __name__ == "__main__":
    sys.exit(main())
