#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# Copyright (C) 2019 tribe29 GmbH - License: GNU General Public License v2
# This file is part of Checkmk (https://checkmk.com). It is subject to the terms and
# conditions defined in the file COPYING, which is part of this source code package.


@get_parsed_item_data
def check_couchbase_nodes_items(_item, params, data):

    active = data.get('curr_items')
    if active is not None:
        yield check_levels(
            active,
            'items_active',
            params.get('curr_items'),
            human_readable_func=six.text_type,
            infoname="Items in active vBuckets",
        )

    non_res = data.get('vb_active_num_non_resident')
    if non_res is not None:
        yield check_levels(
            non_res,
            'items_non_res',
            params.get('non_residents'),
            human_readable_func=six.text_type,
            infoname='Non-resident items',
        )

    total = data.get('curr_items_tot')
    if total is not None:
        yield check_levels(
            total,
            'items',
            params.get('curr_items_tot'),
            human_readable_func=six.text_type,
            infoname='Total items in vBuckets',
        )


check_info['couchbase_nodes_items'] = {
    'inventory_function': discover(lambda _k, v: 'curr_items' in v),
    'check_function': check_couchbase_nodes_items,
    'service_description': 'Couchbase %s vBucket items',
    'includes': ['couchbase.include'],
    'group': 'couchbase_items',
    'has_perfdata': True
}
