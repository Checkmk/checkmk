#!/usr/bin/python
#author: Oguzhan Cicek, OpenSource Security GmbH - oguzhan(at)os-s.de

#Example Input:
#.1.3.6.1.2.1.1.1.0 testname
#.1.3.6.1.2.1.1.2.0 .1.3.6.1.4.1.8072.3.2.10
#[...]
#.1.3.6.1.4.1.8072.1.3.2.1.0 0
#.1.3.6.1.4.1.12356.100.1.1.1.0 FAC-VMTM1234567890
#.1.3.6.1.4.1.12356.100.1.2.1.0 1
#.1.3.6.1.4.1.12356.100.1.2.100.1.0 -1
#.1.3.6.1.4.1.12356.113.1.1.0 FACVM
#.1.3.6.1.4.1.12356.113.1.2.0 FAC-VMTM1234567890
#.1.3.6.1.4.1.12356.113.1.3.0 v5.5.0-build0366
#.1.3.6.1.4.1.12356.113.1.4.0 3
#.1.3.6.1.4.1.12356.113.1.5.0 28
#.1.3.6.1.4.1.12356.113.1.6.0 1
#.1.3.6.1.4.1.12356.113.1.201.1.0 255
#[...]

#Example GUI Output:
#OK	FortiAuthenticator System	Model: FACVM, Serial: FAC-VMTM1234567890, Version: v5.5.0-build0366, HA Status: disabled		fortiauthenticator_system


def inventory_fortiauthenticator_system(info):
    if info:
        return [(None, None)]


def check_fortiauthenticator_system(item, params, info):
    state = 0
    model = info[0][0][0]
    serial = info[0][0][1]
    version = info[0][0][2]
    ha_status_code = int(info[0][0][3])
    ha_codes = {
        1: 'unknownOrDetermining',
        2: 'clusterMaster',
        3: 'clusterSlave',
        4: 'standaloneMaster',
        5: 'loadBalancingSlave',
        255: 'disabled'
    }
    ha_status = ha_codes[ha_status_code]
    statustext = "Model: %s, Serial: %s, Version: %s, HA Status: %s" % (model, serial, version,
                                                                        ha_status)
    yield state, statustext


check_info['fortiauthenticator_system'] = {
    'inventory_function': inventory_fortiauthenticator_system,
    'check_function': check_fortiauthenticator_system,
    'has_perfdata': False,
    'service_description': "FortiAuthenticator System",
    'snmp_info': [(
        '.1.3.6.1.4.1.12356.113.1',
        [
            '1.0',  # facSysModel
            '2.0',  # facSysSerial
            '3.0',  # facSysVersion
            '201.1.0',  # facHaCurrentStatus
        ])],
    'snmp_scan_function': lambda oid: '.1.3.6.1.4.1.8072.3.2.10' in oid('.1.3.6.1.2.1.1.2.0').lower(
    ),
}
