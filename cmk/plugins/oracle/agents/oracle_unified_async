#!/bin/bash
# Copyright (C) 2025 Checkmk GmbH - License: GNU General Public License v2
# This file is part of Checkmk (https://checkmk.com). It is subject to the terms and
# conditions defined in the file COPYING, which is part of this source code package.

# Reason for this no-op: shellcheck disable=... before the first command disables the error for the
# entire script.
:

# Disable unused variable error (needed to keep track of version)
# shellcheck disable=SC2034
CMK_VERSION="2.5.0b1"

if [ -z "${MK_LIBDIR}" ] || [ ! -d "${MK_LIBDIR}" ]; then
    echo "MK_LIBDIR is not set or not directory"
    exit 1
fi

if [ ! -x "${MK_LIBDIR}/mk-oracle" ]; then
    echo "mk-oracle in ${MK_LIBDIR} is not executable or not found"
    exit 1
fi

if [ -z "${MK_CONFDIR}" ] || [ ! -d "${MK_CONFDIR}" ]; then
    echo "MK_CONFDIR is not set or not directory"
    exit 1
fi

if [ ! -f "${MK_CONFDIR}/oracle.yml" ]; then
    echo "Configuration file oracle.yml not found in ${MK_CONFDIR}"
    exit 1
fi

"${MK_LIBDIR}/plugins/packages/mk-oracle/mk-oracle" -c "${MK_CONFDIR}/oracle.yml" --filter async
