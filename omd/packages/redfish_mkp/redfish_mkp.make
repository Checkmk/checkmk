REDFISH_MKP := redfish_mkp

REDFISH_MKP_BUILD := $(BUILD_HELPER_DIR)/$(REDFISH_MKP)-build
REDFISH_MKP_INSTALL := $(BUILD_HELPER_DIR)/$(REDFISH_MKP)-install
REDFISH_MKP_BAZEL_OUT := $(BAZEL_BIN)/omd/packages/$(REDFISH_MKP)/
REDFISH_MKP_OUTPUT_DIR := /share/check_mk/optional_packages
REDFISH_MKP_FILE_PATTERN := redfish-*.mkp

.PHONY: $(REDFISH_MKP_BUILD)
$(REDFISH_MKP_BUILD):
	$(BAZEL_BUILD) //omd/packages/$(REDFISH_MKP):fetch_package

.PHONY: $(REDFISH_MKP_INSTALL)
$(REDFISH_MKP_INSTALL): $(REDFISH_MKP_BUILD)
	$(MKDIR) $(DESTDIR)$(OMD_ROOT)$(REDFISH_MKP_OUTPUT_DIR)
	cp $(REDFISH_MKP_BAZEL_OUT)/$(REDFISH_MKP_FILE_PATTERN) $(DESTDIR)$(OMD_ROOT)$(REDFISH_MKP_OUTPUT_DIR)/
	chmod --changes ugo-x $(DESTDIR)$(OMD_ROOT)$(REDFISH_MKP_OUTPUT_DIR)/$(REDFISH_MKP_FILE_PATTERN)
