# pylint: disable=protected-access
import pytest  # type: ignore[import]

from cmk.base import (
    snmp,
    snmp_utils,
)

import cmk.base.config as config
from cmk.base.check_api import OID_END, BINARY

from testlib.base import Scenario


class _SNMPTestConfig:
    def __init__(self, walk):
        self.character_encoding = "ascii"
        self.walk = walk


class _SNMPTestFactory:
    @staticmethod
    def factory(*_args, **_ka):
        return _SNMPTestBackend()


class _SNMPTestBackend:
    @staticmethod
    def walk(test_config, fetchoid, **_kw):
        pairs = []
        for line in test_config.walk.splitlines():
            if fetchoid not in line:
                continue
            pair = line.strip().split(None, 1)
            oid, value = pair if len(pair) == 2 else (pair[0], "")
            pairs.append((oid, value.encode(test_config.character_encoding)))
        return pairs


@pytest.mark.parametrize(
    "snmp_info, walk, expected_values",
    [
        (
            (
                '.1.3.6.1.4.1.13595.2.2.3.1',
                [
                    OID_END,
                    BINARY("16"),
                ],
            ),
            """
      .1.3.6.1.4.1.13595.2.2.3.1.16.1.0 "FF FF FF "
      .1.3.6.1.4.1.13595.2.2.3.1.16.2.0 "FF FF FF "
      .1.3.6.1.4.1.13595.2.2.3.1.16.3.0 "FF FF FF "
      .1.3.6.1.4.1.13595.2.2.3.1.16.4.0 "FF FF FF "
      """,
            [
                ['1.0', [34, 70, 70, 32, 70, 70, 32, 70, 70, 32, 34]],
                ['2.0', [34, 70, 70, 32, 70, 70, 32, 70, 70, 32, 34]],
                ['3.0', [34, 70, 70, 32, 70, 70, 32, 70, 70, 32, 34]],
                ['4.0', [34, 70, 70, 32, 70, 70, 32, 70, 70, 32, 34]],
            ],
        ),
        (
            (
                '.1.3.6.1.4.1.3854.1.2.2.1.19.33',
                ["1", "2"],  # TODO: Allow integers here! Some plugins use them!
                ["2.1.2", "2.1.14"],
            ),
            """
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.1.0 8
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.1.0 -1
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.1.1 -1
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.1.2 -1
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.2.0 N/A
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.2.1 N/A
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.2.2 N/A
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.3.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.3.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.3.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.4.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.4.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.4.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.5.0 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.5.1 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.5.2 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.6.0 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.6.1 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.6.2 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.7.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.7.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.7.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.8.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.8.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.8.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.9.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.9.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.9.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.10.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.10.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.10.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.11.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.11.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.11.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.12.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.12.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.12.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.14.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.14.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.14.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.15.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.15.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.15.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.16.0 N/A
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.16.1 N/A
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.16.2 N/A
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.17.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.17.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.17.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.18.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.18.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.18.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.19.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.19.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.19.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.20.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.20.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.20.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.21.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.21.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.21.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.22.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.22.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.22.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.23.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.23.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.23.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.24.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.24.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.24.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.25.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.25.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.25.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.26.0 -1
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.26.1 -1
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.26.2 -1
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.27.0 N/A
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.27.1 N/A
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.27.2 N/A
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.28.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.28.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.28.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.29.0 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.29.1 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.29.2 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.30.0 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.30.1 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.30.2 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.31.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.31.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.31.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.32.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.32.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.32.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.33.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.33.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.33.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.34.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.34.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.34.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.35.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.35.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.35.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.36.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.36.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.36.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.37.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.37.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.37.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.38.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.38.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.38.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.39.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.39.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.39.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.40.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.40.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.40.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.41.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.41.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.41.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.42.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.42.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.42.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.43.0 N/A
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.43.1 N/A
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.1.2.1.43.2 N/A
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.1.0 8
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.1.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.1.1 1
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.1.2 -1
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.2.0 Temperatur Kaese
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.2.1 Temperatur Wurst
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.2.2 N/A
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.3.0 21
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.3.1 20
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.3.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.4.0 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.4.1 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.4.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.5.0 1
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.5.1 1
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.5.2 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.6.0 1
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.6.1 1
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.6.2 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.7.0 25
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.7.1 25
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.7.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.8.0 30
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.8.1 30
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.8.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.9.0 18
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.9.1 18
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.9.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.10.0 10
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.10.1 10
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.10.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.11.0 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.11.1 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.11.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.12.0 1
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.12.1 1
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.12.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.14.0 205
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.14.1 200
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.14.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.15.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.15.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.15.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.16.0 -
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.16.1 -
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.16.2 N/A
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.17.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.17.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.17.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.18.0 1
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.18.1 1
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.18.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.19.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.19.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.19.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.20.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.20.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.20.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.21.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.21.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.21.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.22.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.22.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.22.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.23.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.23.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.23.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.24.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.24.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.24.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.25.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.25.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.25.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.26.0 -1
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.26.1 -1
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.26.2 -1
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.27.0 N/A
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.27.1 N/A
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.27.2 N/A
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.28.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.28.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.28.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.29.0 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.29.1 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.29.2 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.30.0 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.30.1 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.30.2 2
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.31.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.31.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.31.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.32.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.32.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.32.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.33.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.33.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.33.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.34.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.34.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.34.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.35.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.35.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.35.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.36.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.36.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.36.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.37.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.37.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.37.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.38.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.38.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.38.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.39.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.39.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.39.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.40.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.40.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.40.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.41.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.41.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.41.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.42.0 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.42.1 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.42.2 0
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.43.0 N/A
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.43.1 N/A
        .1.3.6.1.4.1.3854.1.2.2.1.19.33.2.2.1.43.2 N/A
      """,
            [
                ['1.N/A', '0'],
                ['1.N/A', ''],
                ['1.N/A', ''],
                ['1.0', ''],
                ['1.0', '0'],
                ['1.0', ''],
                ['1.0', ''],
                ['1.0', ''],
                ['1.0', '0'],
                ['1.0', ''],
                ['1.0', ''],
                ['1.0', ''],
                ['1.0', ''],
                ['1.0', ''],
                ['1.0', ''],
                ['1.0', ''],
                ['1.0', ''],
                ['1.0', ''],
                ['1.0', ''],
                ['1.0', ''],
                ['1.0', ''],
                ['1.-1', ''],
                ['1.-1', ''],
                ['1.-1', ''],
                ['1.N/A', ''],
                ['1.N/A', ''],
                ['1.N/A', ''],
                ['1.0', ''],
                ['1.0', ''],
                ['1.0', ''],
                ['1.2', ''],
                ['1.2', ''],
                ['1.2', ''],
                ['2.Temperatur Kaese', '205'],
                ['2.Temperatur Wurst', ''],
                ['2.N/A', ''],
                ['2.0', ''],
                ['2.0', '200'],
                ['2.0', ''],
                ['2.0', ''],
                ['2.0', ''],
                ['2.0', '0'],
                ['2.0', ''],
                ['2.0', ''],
                ['2.0', ''],
                ['2.0', ''],
                ['2.0', ''],
                ['2.0', ''],
                ['2.0', ''],
                ['2.0', ''],
                ['2.0', ''],
                ['2.0', ''],
                ['2.0', ''],
                ['2.0', ''],
                ['2.-1', ''],
                ['2.-1', ''],
                ['2.-1', ''],
                ['2.N/A', ''],
                ['2.N/A', ''],
                ['2.N/A', ''],
                ['2.0', ''],
                ['2.0', ''],
                ['2.0', ''],
                ['2.2', ''],
                ['2.2', ''],
                ['2.2', ''],
            ],
        ),
    ])
def test_get_snmp_table(monkeypatch, snmp_info, walk, expected_values):
    monkeypatch.setattr(snmp, "SNMPBackendFactory", _SNMPTestFactory)
    monkeypatch.setattr(snmp_utils, "is_snmpv3_host", lambda _x: False)
    assert snmp.get_snmp_table(_SNMPTestConfig(walk), "unit-test", snmp_info,
                               False) == expected_values


@pytest.mark.parametrize(
    "encoding,columns,expected",
    [
        (None, [([b'\xc3\xbc'], "string")], [[u"ü"]]),  # utf-8
        (None, [([b'\xc3\xbc'], "binary")], [[[195, 188]]]),  # utf-8
        (None, [([b"\xfc"], "string")], [[u"ü"]]),  # latin-1
        (None, [([b'\xfc'], "binary")], [[[252]]]),  # latin-1
        ("utf-8", [([b'\xc3\xbc'], "string")], [[u"ü"]]),
        ("latin1", [([b'\xfc'], "string")], [[u"ü"]]),
        ("cp437", [([b'\x81'], "string")], [[u"ü"]]),
    ])
def test_sanitize_snmp_encoding(monkeypatch, encoding, columns, expected):
    ts = Scenario().add_host("localhost")
    ts.set_ruleset("snmp_character_encodings", [
        (encoding, [], config.ALL_HOSTS, {}),
    ])
    config_cache = ts.apply(monkeypatch)

    snmp_config = config_cache.get_host_config("localhost").snmp_config("")
    assert snmp._sanitize_snmp_encoding(snmp_config, columns) == expected


def test_is_bulkwalk_host(monkeypatch):
    ts = Scenario().set_ruleset("bulkwalk_hosts", [
        ([], ["localhost"], {}),
    ])
    ts.add_host("abc")
    ts.add_host("localhost")
    config_cache = ts.apply(monkeypatch)
    assert config_cache.get_host_config("abc").snmp_config("").is_bulkwalk_host is False
    assert config_cache.get_host_config("localhost").snmp_config("").is_bulkwalk_host is True
